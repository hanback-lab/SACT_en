# WATCH 2
---

## 7-Segment Array Controller

In Combination Logic, we practiced controlling 7-Segment using BCD to 7-Segment decoder. 
 
The figure below shows the data line of 7-Segment.

<img src="./pds/seg01.png" alt="scmp4_t-cmp4_" style="width: 25%;"><BR><BR>

Characters as below can be displayed by controlling eight data lines.


<img src="./pds/seg01a.png" alt="scmp4_t-cmp4_" style="width: 70%;"><BR><BR>

The table below shows the data to display the characters above.



|Display||a|b|c|d|e|f|g|dp|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|0||1|1|1|1|1|1|0|0|
|1||0|1|1|0|0|0|0|0|
|2||1|1|0|1|1|0|1|0|
|3||1|1|1|1|0|0|1|0|
|4||0|1|1|0|0|1|1|0|
|5||1|0|1|1|0|1|1|0|
|6||1|0|1|1|1|1|1|0|
|7||1|1|1|0|0|0|0|0|
|8||1|1|1|1|1|1|1|0|
|9||1|1|1|1|0|1|1|0|
|A||1|1|1|0|1|1|1|0|
|B||0|1|1|1|1|0|0|0|
|C||1|0|0|1|1|1|0|0|
|D||0|1|1|1|1|0|1|0|
|E||1|0|0|1|1|1|1|0|
|F||1|0|0|0|1|1|1|0|


7-Segment Array configured in the equipment is as below.
<br>

7-Segment of the device has an array structure as shown below. To control one 7-Segment, 8 data lines are required. 8 x 8 = 64 data lines are required to control 8 7-Segments.

<img src="./pds/seg03.png" alt="scmp4_t-cmp4_" style="width: 70%;"><BR><BR>


<br>
To reduce IO resource waste, configure the circuit to share the data lines of 8 7-Segments and control each common terminal as the circuit above. Then, only 16 data lines are required. However, separate 7-Segment Array control circuit is required for this.

<br>

The following shows how to display [1 2 3 4] on 7-Segment Array.


<img src="./pds/seg02.png" alt="scmp4_t-cmp4_" style="width: 70%;"><BR><BR>

- Define the data line required to control 4-digit 7-Segment Array as SEG_COM[3..0] and SEG_DATA[7..0].

- Define 7-Segment common terminal of the first digit as SEG_COM[3] in order of SEG_COM[2], SEG_COM[1], SEG_COM[0].

- Data of 7-Segment are a, b, c, d, e, f, g, dp, which are SEG_DATA[7], SEG_DATA[6], ..., SEG_DATA[1], SEG_DATA[[0], respectively.

- To display the character 1 on the first 7-Segment, 0111 must be passed to SEG_COM[3..0], and "011000000" must be passed to SEG_DATA.

- To display the character 2 on the second 7-Segment, 1011 must be passed to SEG_COM[3..0] and "11011010" must be passed to SEG_DATA.

- To display the character 3 on the third 7-Segment, 1111 must be passed to SEG_COM[3..0], and "11110010" must be passed to SEG_DATA.

- To display the character 4 on the fourth 7-Segment, 1110 must be passed to SEG_COM[3..0] and "01100110" must be passed to SEG_DATA.

- Four data are displayed in order and all four data will be displayed at the same time by speeding up.



<BR><BR>

The following is an example to practice, which receives 4-bit data input of A, B, C, D and displays BCD value input on four 7-Segments.



<img src="./pds/seg04.png" alt="scmp4_t-cmp4_" style="width: 100%;"><BR><BR>



<BR>

Devices connected and pin numbers connected to the device to check in SACT equipment are as below.

|PORT NAME|CLK|
|:-:|:-:|
|HARDWARE|Main Clock|
|PIN NUMBER|G2|

|PORT NAME|A[3]|A[2]|A[1]|A[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S7|S6|S5|S4|
|PIN NUMBER|Y6|W7|AB6|AA7|

|PORT NAME|B[3]|B[2]|B[1]|B[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S3|S2|S1|S0|
|PIN NUMBER|Y7|V8|AB7|Y8|

|PORT NAME|C[3]|C[2]|C[1]|C[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SW7|SW6|SW5|SW4|
|PIN NUMBER|W8|AB8|AA8|V9|

|PORT NAME|D[3]|D[2]|D[1]|D[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SW3|SW2|SW1|SW0|
|PIN NUMBER|U9|AB9|AA9|V10|

|PORT NAME|SEG_COM[7]|SEG_COM[6]|SEG_COM[5]|SEG_COM[4]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SEG_COM[7]|SEG_COM[6]|SEG_COM[5]|SEG_COM[4]|
|PIN NUMBER|U1|T5|T4|T3|

|PORT NAME|SEG_COM[3]|SEG_COM[2]|SEG_COM[1]|SEG_COM[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SEG_COM[3]|SEG_COM[2]|SEG_COM[1]|SEG_COM[0]|
|PIN NUMBER|R5|R4|R3|R2|

|PORT NAME|SEG_DATA[7]|SEG_DATA[6]|SEG_DATA[5]|SEG_DATA[4]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SEG_A|SEG_B|SEG_C|SEG_D|
|PIN NUMBER|R1|P5|P4|R3|

|PORT NAME|SEG_DATA[3]|SEG_DATA[2]|SEG_DATA[1]|SEG_DATA[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SEG_E|SEG_F|SEG_G|SEG_DP|
|PIN NUMBER|P2|P1|N6|N5|


<br>

<img src="./pds/sact-seg.png" alt="scmp4_t-cmp4_" style="width: 60%;">

<br><br>

### **Design**

1. Select File > New Project Wizard in Quartus to create new project.

2. Set Directory, Name, and Top-Level Entry window as below. 

    |Working Directory|d:\work\SEG_DISP|
    |-|-|
    |project Name | SEG_DISP|
    |Top Level Entry Name | SEG_DISP|


3. Set Project Type to Empty project, and do not set Add File window.

4. In Family, Device&Board Setting window, first set Device Family/Package/Pin Count/Core speed grade as shown below, and then set Name.

    |Device Family|Cyclone 10 LP|
    |-|:-:|
    |Package|FBGA|
    |Pin count|484|
    |Core Speed grade|8|
    |Available devices|10CL080YF484C8G|

    <img src="./pds/cnt10_02.png" alt="traffic" style="width: 100%;"><br><br>

>Be careful that if device name changes, programming is not possible.

5. Do not set ‘EDA Tool Settings’.

    Check Summary to confirm the current settings and click Finish to complete project creation.

6. Click File > New menu to open New window and select Block Diagram/Schematic File.

7. Right-click on the drawing and select Insert > Symbol menu (double-click on) the drawing, add symbol to complete the logic circuit.

    <img src="./pds/seg05.png" alt="traffic" style="width: 100%;"><br><br>
    <img src="./pds/seg05a.png" alt="traffic" style="width: 100%;"><br><br>

8. Save. Set file name to project name (default setting).

### **Compile**

9. Select Processing > Start Compilation menu to start compilation.

    This is the process of checking for errors in the design and synthesizing/ generating timing information / generating programming file.


### Device & Pin Assignment

10. Check the operation of the hardware through equipment.

    To check the equipment, set the pin for input/output port.

11. Select Assignment > Device.

    In the Device Settings window that appears, click ‘Device and Pin Options’ 

12. In ‘Device & Pin Option’ window, select “Unused Pins” category and set “Reserve all unused pins” to “As output driving ground”.
    
    It is because that default setting is “As input tri-stated with weak pull-up”, which causes the pins not set to be slightly pulled up, in High state.
    
    Since there are many elements such as LED configured in the equipment, if ‘As output driving ground’ is not set, unset LED may become ON causing output result confusing. Therefore, it is recommended to set Unused Pin as ‘As output driving ground’.

    <img src="./pds/cnt10_17.png" alt="traffic" style="width: 80%;"><br><br>
<br>

13. Select Assignment > Pin Planner to set PIN number.

14. Set PIN number in Location as shown in the table below.
    
    If PIN number is set differently, it will be difficult to check the operation of the device.

|PORT NAME|CLK|
|:-:|:-:|
|HARDWARE|Main Clock|
|PIN NUMBER|G2|

|PORT NAME|A[3]|A[2]|A[1]|A[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S7|S6|S5|S4|
|PIN NUMBER|Y6|W7|AB6|AA7|

|PORT NAME|B[3]|B[2]|B[1]|B[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S3|S2|S1|S0|
|PIN NUMBER|Y7|V8|AB7|Y8|

|PORT NAME|C[3]|C[2]|C[1]|C[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SW7|SW6|SW5|SW4|
|PIN NUMBER|W8|AB8|AA8|V9|

|PORT NAME|D[3]|D[2]|D[1]|D[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SW3|SW2|SW1|SW0|
|PIN NUMBER|U9|AB9|AA9|V10|

|PORT NAME|SEG_COM[7]|SEG_COM[6]|SEG_COM[5]|SEG_COM[4]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SEG_COM[7]|SEG_COM[6]|SEG_COM[5]|SEG_COM[4]|
|PIN NUMBER|U1|T5|T4|T3|

|PORT NAME|SEG_COM[3]|SEG_COM[2]|SEG_COM[1]|SEG_COM[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SEG_COM[3]|SEG_COM[2]|SEG_COM[1]|SEG_COM[0]|
|PIN NUMBER|R5|R4|R3|R2|

|PORT NAME|SEG_DATA[7]|SEG_DATA[6]|SEG_DATA[5]|SEG_DATA[4]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SEG_A|SEG_B|SEG_C|SEG_D|
|PIN NUMBER|R1|P5|P4|R3|

|PORT NAME|SEG_DATA[3]|SEG_DATA[2]|SEG_DATA[1]|SEG_DATA[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SEG_E|SEG_F|SEG_G|SEG_DP|
|PIN NUMBER|P2|P1|N6|N5|

<br>

<img src="./pds/sact-seg.png" alt="scmp4_t-cmp4_" style="width: 60%;">
<br>


15. After setting the pin, close the window and select Processing > Start Compilation menu to proceed with compilation. 
    
    This is to create a programming file that includes Device option and Pin configuration information.
<br><br>
    
### **Check Hardware Operation**

16. Prepare SACT equipment. Connect USB cable and power cable and press the power switch to supply power to the device.

17. In Quartus software, select Tool > Programmer.

18. Check that USB Blaster is connected in Hardware Setup on Programmer window. Press Start button to program to check the operation on the device.

19. Set to 1Hz using CLOCK SELECT SWITCH of CLOCK block and check the display on 7-Segment by changing the value of A(S7-S4), B(S3-S0), C(SW7SW4), D(SW3SW0).

    Check the display when CLOCK is set lower and check the appropriate clock.



|PORT NAME|A[3]|A[2]|A[1]|A[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S7|S6|S5|S4|

|PORT NAME|B[3]|B[2]|B[1]|B[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S3|S2|S1|S0|

|PORT NAME|C[3]|C[2]|C[1]|C[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SW7|SW6|SW5|SW4|

|PORT NAME|D[3]|D[2]|D[1]|D[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|SW3|SW2|SW1|SW0|


<br>

<img src="./pds/sact-seg.png" alt="scmp4_t-cmp4_" style="width: 60%;">

<br>










