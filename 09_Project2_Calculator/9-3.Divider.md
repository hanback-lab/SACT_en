# 4-Bit Calculator 3

---

## 4-Bit Divider

Let’s design a divider for 4-bit A and B data.

If converting the division of 4-bit A and B into subtractor and calculating it.


<BR>
it is as below assuming that data A is 1101 and data B is 0011.

<BR>

<img src="./pds/div01.png" alt="scmp4_t-cmp4_" style="width: 70%;"><br><br>

- (1)<BR>
    - Perform [0 0 0 A3] - B
    - Borrowing number (Br) occurs and moves on to the next
    - The first digit is 0.
    - (It can also be interpreted as : Compare A3 and B and move on to the next step if B >
    <BR><BR>

- (2)<BR>
    - Perform [0 0 A3 A2] - B
    - The second digit is 1 because no borrowing occurred
    <BR><BR>

- (3)<BR>
    - Perform [(A3-B2) (A2-B1) A1] - B
    - Borrowing number (Br) occurs and moves on to the next
    - The third digit is 0
    <BR><BR>

- (4)<BR>
    - Perform [(A3-B2) (A2-B1) A1 A0] - B
    - Borrowing number (Br) occurs and moves on to the next
    - The fourth digit is 0
    <BR><BR>

- (5)<BR>
    - Therefore, the result of [1 1 0 1] / [0 0 1 1] is [0 1 0 0].
    <BR><BR>


This circuit can be configured as below.

<img src="./pds/div02.png" alt="scmp4_t-cmp4_" style="width: 100%;"><br><br>

PU(Processor Unit) consisting of subtractor and 2x1 MUX.


Devices connected and pin numbers connected to the device to check in SACT equipment are as below.



|PORT NAME|A[3]|A[2]|A[1]|A[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S7|S6|S5|S4|
|PIN NUMBER|Y6|W7|AB6|AA7|

|PORT NAME|B[3]|B[2]|B[1]|B[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S3|S2|S1|S0|
|PIN NUMBER|Y7|V8|AB7|Y8|

|PORT NAME|D[3]|D[2]|D[1]|D[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|LED7|LED6|LED5|LED4|
|PIN NUMBER|W2|Y1|Y2|Y3|



<br>

<img src="./pds/sact-div.png" alt="scmp4_t-cmp4_" style="width: 60%;"><br><br>

### **Design**

1. Select File > New Project Wizard in Quartus to create new project.

2. Set Directory, Name, and Top-Level Entry window as below.

    |Working Directory|d:\work\DIV4|
    |-|-|
    |project Name | DIV4|
    |Top Level Entry Name | DIV4|


3. Set Project Type to Empty project, and do not set Add File window.

4. In Family, Device&Board Setting window, first set Device Family/Package/Pin Count/Core speed grade as shown below, and then set Name.

    |Device Family|Cyclone 10 LP|
    |-|:-:|
    |Package|FBGA|
    |Pin count|484|
    |Core Speed grade|8|
    |Available devices|10CL080YF484C8G|

    <img src="./pds/cnt10_02.png" alt="traffic" style="width: 100%;"><br><br>

>Be careful that if device name changes, programming is not possible.

5. Do not set ‘EDA Tool Settings’.

    Check Summary to confirm the current settings and click Finish to complete project creation.

6. Let's use P_ADD_SUB logic circuit, which is 4-bit adder/subtractor logic circuit created previously. 
    
    Copy HA.bdf, HA.bsf, HAFA.bdf, HAFA.bsf, P_ADD_SUB.bdf, P_ADD_SUB.bsf files from the previous 4-bit adder/subtractor project ADD_SUB_4 working directory to the current working directory DIV4.   
    
    >Since P_ADD_SUB is separately created circuit, it must be included in the project folder. If not, error message that there is no file when compiling will come out.  

<br>

> Since the symbol file was already created, just copy the file above to use.

7. Click File > New menu to open New window and select Block Diagram/Schematic File.

8. Right-click on the drawing and select Insert > Symbol menu (double-click on the drawing). Import input symbol, output symbol, vcc symbol, P_ADD_SUB symbol and place them on the drawing.


9. Complete the drawing by modifying the names of input and output, adding more symbols and connecting the symbols with wire as shown below.
    
    - ERO,ZERO,ZERO,A[3] in A[3..0] of the first P_ADD_SUB is to input [0 0 0 A3] to the first data.
    
    - Connect VCC to M of P_ADD_SUB to set to operate as a subtractor.
    
    - Since P_ADD_SUB is used as a subtractor, COUT is output as SIGN. If borrow number occurs, 0 is output, and if borrow number does not occur, 1 is output.
    
    - Since the borrowing number has occurred indicates B < A, the quotient becomes 0, and it is passed to the next calculation formula by MUX of 74157.
    
    - If the borrowing number does not occur, A > B and the quotient becomes 0. Difference between the two values is passed to the next calculation formula by MUX of 74157.

    <img src="./pds/div03a.png" alt="traffic" style="width: 100%;"><br><br>
    <img src="./pds/div03b.png" alt="traffic" style="width: 80%;"><br><br>
    <img src="./pds/div03c.png" alt="traffic" style="width: 80%;"><br><br>
    <img src="./pds/div03d.png" alt="traffic" style="width: 80%;"><br><br>

10. Save. Set file name to project name (default setting).

### **Compile**

11. Select Processing > Start Compilation menu to start compilation.

    This is the process of checking for errors in the design and synthesizing/ generating timing information / generating programming file.


### **Simulation**


12. Once compilation is complete, start simulation.

    Select File > New and select “University Program VWF” under Verification/Debugging Files in New window that appears.

13. In Simulation Waveform Editor window, select Edit > Insert > Insert Node or Bus.

14. Press Node Finder button, press List button in Node Finder window, and press “>>” button in Nodes Found. Then, click OK button to add input/output port to Simulation Waveform Editor window.

15. In Simulation Waveform Editor window, drag and select some of port A with the mouse and press ? icon to enter the data of the input condition. Enter data into port B in the same way.

    Set CTR value by pressing icon 0 or icon 1.

    <img src="./pds/div04.png" alt="traffic" style="width: 100%;"><br><br>

16. SAVE. Leave the file name as default.

17. Select Simulation > Simulation Setting menu and delete “ –novopt” in the window that appears.

    <img src="./pds/cnt10_14a.png" alt="traffic" style="width: 80%;"><br><br>

>If this “-novopt’ is not deleted, the following message will appear upon the simulation.

    <img src="./pds/cnt10_14b.png" alt="traffic" style="width: 80%;"><br><br>


18. Select Simulation > Run Functional Simulation menu to run the simulation.
Check value of A / B in D.

    COUT appears when overflow occurs in addition, and Sign appears when B is greater than A in subtraction.

   <img src="./pds/div05.png" alt="traffic" style="width: 100%;"><br><br>
    <br>

    If changing Radix of each port to unsigned Decimal, it is easier to check. 

    <br><br>
   <img src="./pds/div05a.png" alt="traffic" style="width: 1000%;"><br><br>


### Device & Pin Assignment

19. After predicting the operation of designed logic circuit through simulation, let’s verify the operation of the hardware through equipment.

    To check the equipment, set the pin for input/output port.
<br>

20. Select Assignment > Device.
In the Device Settings window that appears, click ‘Device and Pin Options’ button.

21. In ‘Device & Pin Option’ window, select “Unused Pins” category and set “Reserve all unused pins” to “As output driving ground”.
    
    It is because that default setting is “As input tri-stated with weak pull-up”, which causes the pins not set to be slightly pulled up, in High state.
    
    Since there are many elements such as LED configured in the equipment, if ‘As output driving ground’ is not set, unset LED may turn ON causing output result confusing. Therefore, it is recommended to set Unused Pin as ‘As output driving ground’.


    <img src="./pds/cnt10_17.png" alt="traffic" style="width: 80%;"><br><br>
<br>

22. Select Assignment > Pin Planner to set PIN number.

23. Set PIN number in Location as shown in the table below.
If PIN number is set differently, it will be difficult to check the operation of the device.



|PORT NAME|A[3]|A[2]|A[1]|A[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S7|S6|S5|S4|
|PIN NUMBER|Y6|W7|AB6|AA7|

|PORT NAME|B[3]|B[2]|B[1]|B[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S3|S2|S1|S0|
|PIN NUMBER|Y7|V8|AB7|Y8|

|PORT NAME|D[3]|D[2]|D[1]|D[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|LED7|LED6|LED5|LED4|
|PIN NUMBER|W2|Y1|Y2|Y3|



<br>

<img src="./pds/sact-div.png" alt="scmp4_t-cmp4_" style="width: 60%;"><br><br>

24. After setting the pin, close the window and select Processing > Start Compilation menu to proceed with compilation. 

    This is to create a programming file that includes Device option and Pin configuration information.


<br><br>
    
### **Check Hardware Operation**

25. Prepare SACT equipment. Connect USB cable and power cable and press the power switch to supply power to the device.

26. In Quartus software, select Tool > Programmer.

27. Check that USB Blaster is connected in Hardware Setup on Programmer window. Press Start button to program to check the operation on the device.

28. Set the data value of A and B by moving the slide switch S7-S4, S3-S0. Check the result of addition or subtraction through LED using button switch SW7.


|PORT NAME|A[3]|A[2]|A[1]|A[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S7|S6|S5|S4|

|PORT NAME|B[3]|B[2]|B[1]|B[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|S3|S2|S1|S0|

|PORT NAME|D[3]|D[2]|D[1]|D[0]|
|:-:|:-:|:-:|:-:|:-:|
|HARDWARE|LED7|LED6|LED5|LED4|

<br>

<img src="./pds/sact-div.png" alt="scmp4_t-cmp4_" style="width: 60%;"><br><br>
